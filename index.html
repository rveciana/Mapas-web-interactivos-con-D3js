<!DOCTYPE html>
<html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">

<style>

@import url(http://fonts.googleapis.com/css?family=Open+Sans);

section {
  background: #23241f;
  color: #fff;
  padding: 2em;
  font-family: "Open Sans", Baskerville, Georgia;
  font-size: .6em;
}

a:link,
a:visited {
  color: orange;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

h1 {
  font-size: 3.5em;
  line-height: 1em;
  font-weight: bold;  
}

h2 {
  font-size: 2em;
  line-height: 1em;
}

h3 {
  font-size: 2em;
  line-height: 1em;
}

.row {
  display: block;
  overflow: hidden;
  clear: both;
  position: relative;
  margin: 0px auto;
}

.pie {  
  text-align: left;
  position: absolute;
  bottom: 150px;
}


.blue {
  color: #6baed6;
}

.gray {
  color: #969696;
}

.left {
  float: left;
}

blockquote {
  background: #333333;
  border-left: 10px solid #6baed6;
  margin: 1.5em 10px;
  padding: 0.5em 10px;
  quotes: "\201C""\201D""\2018""\2019";
}
blockquote:before {
  color: #6baed6;
  content: open-quote;
  font-size: 4em;
  line-height: 0.1em;
  margin-right: 0.25em;
  vertical-align: -0.4em;
}
blockquote p {
  display: inline;
}

mark.blue {
  color: #6baed6;
  background: none;
}
</style>
<script src="d3.v3.min.js"></script>
<script src="stack.v1.min.js"></script>
<body>
<section style="text-align:center;padding-top:5em;">
  <div class="row">
    <h1 class="blue">Mapas web interactivos con D3.js</h1>  
  </div>

  <div class="row pie">
    <div>Roger Veciana i Rovira</div>
    <div><a href="https://twitter.com/rveciana">@rveciana</a></div> 
    <div><a href="http://geoexamples.blogspot.com">GeoExamples</a></div>    
  </div>
</section>

<section style="text-align:center;padding-top:5em;">
    
    <h1 class="blue">¿Qué es D3?</h1>
    <h3>Data Driven Documents</h3>
    <blockquote>
      <p>
       Librería JavaScript que usa datos para la creación y control de visualizaciones dinámicas e interactivas en navegadores web
     </p>
    </blockquote>

</section>
<section style="text-align:center;padding-top:5em;">
    
    <h1 class="blue">¿Qué es D3?</h1>
    <h2>Datos -> Documentos</h2>

</section>
<section style="text-align:center;padding-top:5em;">
    
    <h1 class="blue">¿Qué NO es D3?</h1>
    <ul>
      <li>Una librería de mapas <mark class="blue">pero se pueden hacer mapas con ella</mark></li>
      <li>Una librería de gráficos <mark class="blue">pero se pueden hacer gráficos con ella</mark></li>
      <li>Una herramienta de generación de SVG, Canvas o HTML</li>
      <li>Una librería de dibujo <mark class="blue">no tiene ninguna función para dibujar</mark></li>
    </ul>
</section>
<section style="text-align:center;padding-top:5em;">
    
    <h1 class="blue">¿Qué es D3?</h1>
    <h2>Transformación de información a elementos de la página web</h2>

</section>
<section>
    
    <h3 class="blue">HTML</h3>
    <pre>
      <code class="xml">
        &lt;table&gt;
          &lt;tr&gt;
            &lt;th&gt;Partido&lt;/th&gt;&lt;th&gt;Votos&lt;/th&gt;
          &lt;/tr&gt;
          &lt;tr&gt;
            &lt;td&gt;PSOE&lt;/td&gt;&lt;td&gt;16%&lt;/td&gt;
          &lt;/tr&gt;
        &lt;/table&gt;
      </code>
    </pre>

  <div class="row">
    <h3>Resultado:</h3>
    
    <table>
        <tr>
          <th>Partido</th><th>Votos</th>
        </tr>
        <tr>
          <td>PSOE</td><td>16%</td>
        </tr>
    </table>
    
  </div>


</section>

<section>
    
    <h3 class="blue">SVG</h3>
    <pre>
      <code class="xml">
        &lt;svg width="100" height="100"&gt;
          &lt;circle cx="50" cy="50" r="40" stroke="red" stroke-width="4" fill="#FF9999" /&gt;
          &lt;text x="25" y="55" font-family="sans-serif" font-size="20px" fill="red"&gt;PSOE&lt;/text&gt;
        &lt;/svg&gt;
      </code>
    </pre>

  <div class="row">
    <h3>Resultado:</h3>
    
    <svg width="100" height="100">
      <circle cx="50" cy="50" r="40" stroke="red" stroke-width="4" fill="#FF9999" />
      <text x="25" y="55" font-family="sans-serif" font-size="20px" fill="red">PSOE</text>
    </svg>
    
  </div>


</section>

<section>
    
    <h3 class="blue">Canvas</h3>
    <pre>
      <code class="xml" >
        &lt;canvas id="myCanvas" width="100" height="100"&gt;&lt;/canvas&gt;
        &lt;script&gt;
          var canvas = document.getElementById('myCanvas');
          var context = canvas.getContext('2d');

          context.beginPath();
          context.arc(50, 50, 40, 0, 2 * Math.PI, false);
          context.fillStyle = '#FF9999';
          context.fill();
          context.lineWidth = 4;
          context.strokeStyle = 'red';
          context.stroke();
          context.fillStyle = 'red';
          context.font = '20px sans-serif';
          context.fillText('PSOE', 25, 55);
        &lt;/script&gt;
      &lt;/code&gt;
    </pre>

  

</section>

<section>
  <div class="row">
    <h3 class="blue">Resultado:</h3>
    
    <canvas id="myCanvas" width="100" height="100"></canvas>
    <script>
      var canvas = document.getElementById('myCanvas');
      var context = canvas.getContext('2d');

      context.beginPath();
      context.arc(50, 50, 40, 0, 2 * Math.PI, false);
      context.fillStyle = '#FF9999';
      context.fill();
      context.lineWidth = 4;
      context.strokeStyle = 'red';
      context.stroke();
      context.fillStyle = 'red';
      context.font = '20px sans-serif';
      context.fillText('PSOE', 25, 55);
    </script>
    
  </div>

</section>

<section>
  <h3 class="blue">Funcionamiento básico de D3js: Nodos y datos</h3>
  <pre>
  <code class="javascript">
  d3.select('#contenedor').selectAll("div")
    .data([10, 20, 30])
    .enter()
    .append('div')
    .text(function(d){return d;});
  </code>
  </pre>

  <div id="contenedor"></div>

  <script>
  d3.select('#contenedor').selectAll("div")
    .data([10, 20, 30])
    .enter()
    .append('div')
    .text(function(d){return d;});
    </script>
    <h3 class="blue">¿Como funciona esto?</h3>

  </section>
  
<section>
  <h3 class="blue">Búsqueda de instancias de datos</h3>
  <pre>
  <code class="javascript">
  d3.select('#contenedor').selectAll("div")
  </code>
  </pre>
</section>

<section>
  <h3 class="blue">Se definen los datos a vincular con la selección</h3>
  <pre>
  <code class="javascript">
  .data([10, 20, 30])
  </code>
  </pre>
  <ul>
    <li>Los datos pueden ser estructuras complejas</li>
  </ul>
</section>

<section>
  <h3 class="blue">Se escojen los datos que no están en la selección</h3>
  <pre>
  <code class="javascript">
  .enter()
  </code>
  </pre>
  <ul>
    <li>Los elementos que antes estaban y ahora no se controlan con <i>exit()</i></li>
  </ul>
</section>

<section>
  <h3 class="blue">Se añaden los elementos al DOM</h3>
  <pre>
  <code class="javascript">
     .append('div')
    .text(function(d){return d;});
  </code>
  </pre>
  <div class="blue">Para cada elemento devuelto por enter()</div>
  <ul>
    <li>Los métodos se encadenan</li>
    <li>Los valores pueden ser funciones o constantes</li>
    <li>Se pueden añadir atributos usando <i>attr</i></li>
    <li>Se pueden añadir estilos usando <i>style</i></li>
  </ul>
</section>
<section id="tools">
  <h3 class="blue">¿Que otras herramientas ofrece D3?</h3>
  
  <div id="toolsDiv"></div>
  <div id="toolsTitle"></div>
  <pre><code class="JavaScript" id="toolsCode">svg.selectAll("circle")
    .data([32, 57, 112])
    .enter()
    .append("circle")
    .attr("cy", 30)
    .attr("cx", function(d, i) { return i * 50 + 10; })
    .attr("r", function(d) { return Math.sqrt(d); })
    .style("fill", "red");</code></pre>
</section>

<section id="tools2">
  <h3 class="blue">¿Que otras herramientas ofrece D3?</h3>
  
  <div id="tools2Div"></div>
  <div id="tools2Title"></div>
  <pre><code class="JavaScript" id="tools2Code">var scale = d3.scale.linear()
    .domain([30, 120])
    .range([10, 30]);
      
    svg.selectAll("circle")
    .data([32, 57, 112])
    .enter()
    .append("circle")
    .attr("cy", 30)
    .attr("cx", function(d, i) { return i * 50 + 10; })
    .attr("r", function(d) { return scale(d); })
    .style("fill", "red");</code></pre>
</section>

<section>
  <h3 class="blue">Layouts</h3>
  <a href="http://d3js.org/"><img src="layouts.jpg"/></a>
</section>
<section>
  <h3 class="blue">Funciones Geográficas</h3>
  <ul>
    <li><a href="https://github.com/mbostock/d3/wiki/Geo-Projections">Proyecciones</a></li>
    <li><a href="http://bl.ocks.org/rveciana/fcba0c3e2294492f8e3a">Gratículas</a></li>
    <li><a href="http://bl.ocks.org/mbostock/4090870">GeoJSON/TopoJSON</a></li>
    <li><a href="http://bl.ocks.org/mbostock/2206590">Áreas, longitudes, centroides</a> y <a href="http://bl.ocks.org/mbostock/4206810">otros cálculos sencillos</a> y <a href="http://bl.ocks.org/mbostock/4525362">no tan sencillos</a></li>
  </ul>
</section>
<link rel="stylesheet" type="text/css" href="highlight/styles/monokai_sublime.css"> 
<script type="text/javascript" src="highlight/highlight.pack.js"></script>
<script>
  hljs.configure({tabReplace: '    '});
  hljs.initHighlightingOnLoad();
</script>


<script type="text/javascript">

//d3.selectAll("code").each(function() { hljs.highlightBlock(this); });

  var mystack = stack()
      .on("activate", activate)
      .on("deactivate", deactivate);

  var section = d3.selectAll("section");
  var tools = d3.select("#tools");
  var toolsIndex = section[0].indexOf(tools.node());

  var tools2 = d3.select("#tools2");
  var tools2Index = section[0].indexOf(tools2.node());
 
  function activate(d, i) {
    if (i === toolsIndex) startTools();
    if (i === tools2Index) startTools2();
  }

  function deactivate(d, i) {
    if (i === toolsIndex) stopTools();
    if (i === tools2Index) stopTools2();
  }

  
  function startTools(){
    var num_click = 0;
    var title = d3.select("#toolsTitle");
    title.text("Páginas dinámicas");
    var code = d3.select("#toolsCode");

    var svg = d3.select("#toolsDiv").append("svg")
    .attr("width", 200)
    .attr("height", 70);
    
    svg.selectAll("circle")
    .data([32, 57, 112])
    .enter()
    .append("circle")
    .attr("cy", 30)
    .attr("cx", function(d, i) { return i * 50 + 10; })
    .attr("r", function(d) { return Math.sqrt(d); })
    .style("fill", "red");
    
    svg.on("click", function(d) {
        num_click++;
        if(num_click==1){
          
          title.text("Eventos");
          title.transition()
          .duration(2000)
          .style("color", "orange");

          code.text("svg.on('mouseover', function(d){ \n\
            d3.select(this)\n\
            .selectAll(\"circle\")\n\
            .attr(\"r\", function(d) { return Math.sqrt(d) + 5; });\n\
            });\n\
            svg.on('mouseout', function(d){\n\
            \n\
            d3.select(this)\n\
            .selectAll(\"circle\")\n\
            .attr(\"r\", function(d) { return Math.sqrt(d); });\n\
             });");

          svg.on('mouseover', function(d){
            
            d3.select(this)
            .selectAll("circle")
            .attr("r", function(d) { return Math.sqrt(d) + 5; });
          });

          svg.on('mouseout', function(d){
            
            d3.select(this)
            .selectAll("circle")
            .attr("r", function(d) { return Math.sqrt(d); });
          });

        }else if(num_click==2){
          title.text("Transiciones");
          title.transition()
          .duration(2000)
          .style("color", "orange");

          code.text(".selectAll(\"circle\")\n\
            .transition()\n\
            .duration(1500)\n\
            .attr(\"r\", function(d) { return Math.sqrt(d) + 5; });");

          svg.on('mouseover', function(d){
            d3.select(this)
            .selectAll("circle")
            .transition()
            .duration(1500)
            .attr("r", function(d) { return Math.sqrt(d) + 5; });
          });

          svg.on('mouseout', function(d){
            d3.select(this)
            .selectAll("circle")
            .transition()
            .duration(1500)
            .attr("r", function(d) { return Math.sqrt(d); });
          });
        } else if(num_click==3){
          title.text("Más transiciones");

          code.text(".selectAll(\"circle\")\n\
            .transition()\n\
            .duration(1500)\n\
            .delay(function(d,i){return 1000*i;})\n\
            .attr(\"r\", function(d) { return Math.sqrt(d) + 5; })\n\
            .style(\"fill\", \"yellow\");");


          svg.on('mouseover', function(d){
            d3.select(this)
            .selectAll("circle")
            .transition()
            .duration(1500)
            .delay(function(d,i){return 1000*i;})
            .attr("r", function(d) { return Math.sqrt(d) + 5; })
            .style("fill", "yellow");
          });

          svg.on('mouseout', function(d){
            d3.select(this)
            .selectAll("circle")
            .transition()
            .duration(1500)
            .delay(function(d,i){return 1000*i;})
            .attr("r", function(d) { return Math.sqrt(d); })
            .style("fill", "red");
          });
        } else if(num_click==4){
          title.text("Transiciones encadenadas");

          code.text(".selectAll(\"circle\")\n\
            .transition()\n\
            .duration(1500)\n\
            .delay(function(d,i){return 1000*i;})\n\
            .attr(\"r\", function(d) { return Math.sqrt(d) + 5; })\n\
            .style(\"fill\", \"yellow\")\n\
            .transition()\n\
            .attr(\"cx\", function(d, i) { return i * 70 + 10; });");


          svg.on('mouseover', function(d){
            d3.select(this)
            .selectAll("circle")
            .transition()
            .duration(1500)
            .delay(function(d,i){return 1000*i;})
            .attr("r", function(d) { return Math.sqrt(d) + 5; })
            .style("fill", "yellow")
            .transition()
            .attr("cx", function(d, i) { return i * 70 + 10; });
          });

          svg.on('mouseout', function(d){
            d3.select(this)
            .selectAll("circle")
            .transition()
            .duration(1500)
            .delay(function(d,i){return 1000*i;})
            .attr("r", function(d) { return Math.sqrt(d); })
            .style("fill", "red")
            .attr("cx", function(d, i) { return i * 50 + 10; });
          });
        } else if(num_click==5){
          title.text("Zoom/Pan");


          code.text("function zoomed() {\n\
            svg.attr(\"transform\", \"translate(\" + d3.event.translate + \")scale(\" + d3.event.scale + \")\");\n\
          }\n\
          var zoom = d3.behavior.zoom()\n\
          .translate([0, 0])\n\
          .on(\"zoom\", zoomed);\n\
          svg\n\
            .call(zoom)\n\
            .call(zoom.event);");


          function zoomed() {
            svg.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
          }

          var zoom = d3.behavior.zoom()
          .translate([0, 0])
          .on("zoom", zoomed);

          svg
            .call(zoom)
            .call(zoom.event);

          

          svg.on('mouseover', function(d){
            d3.select(this)
            .selectAll("circle")
            .transition()
            .duration(1500)
            .delay(function(d,i){return 1000*i;})
            .attr("r", function(d) { return Math.sqrt(d) + 5; })
            .style("fill", "yellow")
            .transition()
            .attr("cx", function(d, i) { return i * 70 + 10; });
          });

          svg.on('mouseout', function(d){
            d3.select(this)
            .selectAll("circle")
            .transition()
            .duration(1500)
            .delay(function(d,i){return 1000*i;})
            .attr("r", function(d) { return Math.sqrt(d); })
            .style("fill", "red")
            .attr("cx", function(d, i) { return i * 50 + 10; });
          });
        }
    });
    }

  /*

    <li>Herramientas para gráficos
      <ul>
      <li>Escalas</li>
      <li>Ejes</li>
      <li>Funciones de tiempo</li>
      <li>Funciones con colores</li>
    </ul>
  </li>
  <li>Layouts</li>
  <li>Funciones Geográficas</li>
  */
  function stopTools(){
    console.info("stop");
    var svg = d3.select("#toolsDiv").selectAll("svg");
    svg.remove();

  }

  function startTools2(){
    var num_click = 0;
    var title = d3.select("#tools2Title");
    title.text("Consideremos los mismos círculos");
    var code = d3.select("#tools2Code");

    var scale = d3.scale.linear()
    .domain([30, 120])
    .range([2, 30]);

    var svg = d3.select("#tools2Div").append("svg")
    .attr("width", 200)
    .attr("height", 70);
    
    svg.selectAll("circle")
    .data([32, 57, 112])
    .enter()
    
    .append("circle")
    .attr("cy", 30)
    .attr("cx", function(d, i) { return i * 50 + 10; })
    .attr("r", function(d) { return scale(d); })
    .style("fill", "red");
    
    svg.on("click", function(d) {
        num_click++;
        if(num_click==1){
          title.text("Escalas logarítmicas, cuadráticas...");

          code.text("var scale = d3.scale.log()\n\
          .domain([30, 120])\n\
          .range([10, 30]);\n\
          \n\
          svg.selectAll(\"circle\")\n\
          .transition()\n\
          .attr(\"r\", function(d) { console.info(d); return scale(d); });");
          var scale = d3.scale.log()
          .domain([30, 120])
          .range([10, 30]);

          svg.selectAll("circle")
          .transition()
          .attr("r", function(d) { return scale(d); });

        } else if(num_click==2){
          title.text("Escalas de colores");
          code.text("var colorScale = d3.scale.category10()\n\
          .domain([20,120]);\n\
          \n\
          svg.selectAll(\"circle\")\n\
          .transition()\n\
          .style(\"fill\", function(d) { return colorScale(d); });");

          var colorScale = d3.scale.category10()
          .domain([20,120]);
          
          svg.selectAll("circle")
          .transition()
          .style("fill", function(d) { return colorScale(d); });
        } else if(num_click==3){
          title.text("Funciones con los colores");
          code.text("var colorScale = d3.scale.category10()\n\
          .domain([20,120]);\n\
          \n\
          svg.selectAll(\"circle\")\n\
          .transition()\n\
          .style(\"fill\", function(d) { return d3.rgb(colorScale(d)).brighter(); });");

          var colorScale = d3.scale.category10()
          .domain([20,120]);
          
          svg.selectAll("circle")
          .transition()
          .duration(2000)
          .style("fill", function(d) { return d3.rgb(colorScale(d)).brighter(); });
          
        }
    });
  }


  function stopTools2(){
    console.info("stop");
    var svg = d3.select("#tools2Div").selectAll("svg");
    svg.remove();

  }

</script>
</body>
</html>